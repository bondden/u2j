{"version":3,"sources":["importer.es7.js"],"names":[],"mappings":"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","file":"importer.es7.js","sourcesContent":["/**\n * Created by Denis Bondarenko <bond.den@gmail.com> on 16.05.2015.\n */\n'use strict';\n/**\n * Connects to OrientDb server.\n * Creates DB schema or adds classes to existent schema from parsedData.\n */\n\nimport * as UtilLib from '../lib/util'\n\nvar\n\tfs=require('fs'),\n\tI=require('cli-color'),\n\tL\t= UtilLib.Util.log,\n\tC = console.log\n;\n\nexport class Importer {\n\n\tconstructor(db,cnf){\n\t\tthis.db=db;\n\t\tthis.cnf=cnf;\n\t\tthis.parsedData=false;\n\t\tthis.existentClasses=[];\n\t}\n\n\tgetExistentClasses(){\n\n\t\tvar holder=this;\n\n\t\treturn new Promise(function(resolve,reject){\n\n\t\t\tC('//at getExistentClasses.Promise');\n\n\t\t\tholder.db.class.list().then(function(classes){\n\n\t\t\t\tC('db.class.list -> classes:');\n\t\t\t\tclasses.forEach(function(v0,i0){\n\t\t\t\t\tC(v0.name);\n\t\t\t\t});\n\t\t\t\tL();\n\n\t\t\t\tclasses.forEach(function(c){\n\t\t\t\t\tholder.existentClasses.push(c);\n\t\t\t\t});\n\n\t\t\t\tresolve(holder.existentClasses);\n\n\t\t\t}).catch(function(e){\n\t\t\t\tL('Importer #11','er',e);\n\t\t\t\treject(e);\n\t\t\t});\n\t\t});\n\n\t}\n\n\tinsertClassProperty(className,propData){\n\n\t\tC(I.yellow('\\t\\t\\t\\tat insertClassProperty of '+className)+'{'+I.whiteBright(propData.name+':'+propData.type)+'}');\n\n\t\tvar holder=this;\n\t\t//var holder=this;\n\t\treturn new Promise(function(resolve,reject){\n\n\t\t\tlet q=`create property ${className}.${propData.name} ${propData.type}`;\n\t\t\t//C(q);\n\n\t\t\tholder.db.exec(q).then(function(r){\n\n\t\t\t\tC(I.greenBright('\\tprop created '+className+'.'+propData.name+' with '+r.results.length+' results'));\n\t\t\t\t//C(r);\n\t\t\t\tC('\\n');\n\n\t\t\t\tresolve(r);\n\n\t\t\t}).catch(function(e){\n\n\t\t\t\tL('Importer #3','er',e);\n\t\t\t\tL('query: '+q);\n\n\t\t\t\t//todo: normal logging or remove in open version\n\t\t\t\tlet date=new Date();\n\t\t\t\tlet t=date.toTimeString();\n\t\t\t\tfs.appendFile(\n\t\t\t\t\tholder.cnf.path.logFile,\n\t\t\t\t\t'['+t+'] '+__filename+': Error#3; query: \"'+q+'\"; raw: '+JSON.stringify(e)+'\\n'\n\t\t\t\t);\n\n\t\t\t\treject(e);\n\n\t\t\t});\n\n\t\t});\n\t}\n\n\tclassExists(className){\n\n\t\tC(I.white('\\t\\t\\t\\tat classExists ')+I.whiteBright(className));\n\n\t\tvar holder=this;\n\n\t\treturn new Promise(function(resolve,reject){\n\n\t\t\tC(I.white('\\t\\t\\t\\tat classExists.Promise of ')+I.whiteBright(className));\n\n\t\t\tholder.db.class.get(className).then(function(classPtr){\n\n\t\t\t\tC(I.white('\\nclassExists.exists '+className));\n\n\t\t\t\tresolve(classPtr);\n\n\t\t\t}).catch(function(e){\n\t\t\t\tresolve(false);\n\t\t\t});\n\n\t\t});\n\n\t}\n\n\t/**\n\t *\n\t * @param classes:Array - list of classes to be dropped\n\t */\n\tdropClasses(classes){\n\n\t\tC('//at dropClasses');\n\n\t\tvar holder=this;\n\n\t\tif(holder.cnf.orient.dropClassesBeforeImport){\n\n\t\t\tlet promises=[];\n\t\t\tclasses.forEach(function(c,i){\n\t\t\t\tpromises.push(new Promise(function(resolve,reject){\n\t\t\t\t\tholder.db.class.drop(c.name).then(function(r){\n\t\t\t\t\t\tresolve(r);\n\t\t\t\t\t}).catch(function(e){\n\t\t\t\t\t\treject(e);\n\t\t\t\t\t});\n\t\t\t\t}));\n\t\t\t});\n\t\t\treturn Promise.all(promises);\n\n\t\t}else{\n\n\t\t\treturn new Promise(function(resolve,reject){\n\t\t\t\tresolve(true);\n\t\t\t});\n\n\t\t}\n\n\t}\n\n\tinsertClassCheckless(classData){\n\n\t\tC('\\n\\t\\t\\t\\tat insertClassCheckless '+I.whiteBright.bold(classData.name));\n\n\t\tvar holder=this;\n\n\t\treturn new Promise(function(resolve,reject){\n\n\t\t\tC('\\n\\t\\t\\t\\tat insertClassCheckless Promise of '+I.whiteBright.bold(classData.name));\n\n\t\t\tlet c={\n\t\t\t\t\"name\"     :classData.name,\n\t\t\t\t\"extends\"  :'',\n\t\t\t\t\"abstract\" :''\n\t\t\t};\n\t\t\tif(classData.hasOwnProperty('superClass')&&classData.superClass){\n\t\t\t\tc.extends=' extends '+classData.superClass;\n\t\t\t}\n\t\t\tif(classData.hasOwnProperty('abstract')&&classData.abstract){\n\t\t\t\tc.abstract=' ABSTRACT';\n\t\t\t}\n\t\t\tlet q=`create class ${c.name}${c.extends}${c.abstract}`;\n\n\t\t\tL('\\nq: '+q);\n\n\t\t\tholder.db.exec(q).then(function(r){\n\n\t\t\t\tL('\\ncreated class '+classData.name,'ok');\n\t\t\t\tL(r);\n\n\t\t\t\t//holder.db.class.get(classData.name).then(function(recentClass){\n\n\t\t\t\tlet promises=[];\n\t\t\t\tclassData.properties.forEach(function(p){\n\t\t\t\t\tpromises.push(holder.insertClassProperty(classData.name,p));\n\t\t\t\t});\n\t\t\t\tpromises.push(new Promise(function(rs,rj){\n\t\t\t\t\tsetTimeout(function(){\n\t\t\t\t\t\trj(new Error('Timeout '+holder.cnf.timeout+' ms'));\n\t\t\t\t\t},holder.cnf.timeout);\n\t\t\t\t}));\n\n\t\t\t\tPromise.all(promises).then(function(r){\n\n\t\t\t\t\tL('props '+classData.name,'mb');\n\t\t\t\t\tresolve(r);\n\n\t\t\t\t}).catch(function(e){\n\n\t\t\t\t\tL('Importer #4','er',e);\n\t\t\t\t\tL('props of '+classData.name);\n\t\t\t\t\tL();\n\t\t\t\t\treject(e);\n\n\t\t\t\t});\n\n\t\t\t\t/*}).catch(function(e){\n\n\t\t\t\t\tC(clc.red('Importer #12'));\n\t\t\t\t\tC(e);\n\t\t\t\t\treject(e);\n\n\t\t\t\t});*/\n\n\t\t\t}).catch(function(e){\n\n\t\t\t\tL('Importer #5','er',e);\n\t\t\t\treject(e);\n\n\t\t\t});\n\n\t\t\tC('\\n');\n\n\t\t});\n\t}\n\n\tinsertClass(classData){\n\n\t\tC(I.white('\\n\\t\\tat insertClass ')+I.whiteBright.bold(classData.name));\n\n\t\tvar holder=this;\n\n\t\treturn new Promise(function(resolve,reject){\n\n\t\t\tC(I.white('\\t\\t\\t\\tat Promise of ')+I.whiteBright(classData.name));\n\n\t\t\tholder.classExists(classData.name).then(function(rClassExists){\n\n\t\t\t\tC('\\nclass '+I.whiteBright(classData.name)+' exists: '+I.cyan(rClassExists));\n\n\t\t\t\tif(rClassExists){\n\n\t\t\t\t\tC(I.magentaBright('exists ')+classData.name);\n\t\t\t\t\tresolve(rClassExists);\n\n\t\t\t\t}else{\n\n\t\t\t\t\tC(I.magentaBright('absent ')+classData.name);\n\t\t\t\t\tC(I.white('Checking parents...'));\n\t\t\t\t\t//C(I.white(JSON.stringify(classData)));\n\n\t\t\t\t\tif(classData.hasOwnProperty('superClass') && classData.superClass){\n\n\t\t\t\t\t\tC(I.blue('\\nclass ')+classData.name+I.blueBright('.hasSuper')+'('+classData.superClass+')');\n\n\t\t\t\t\t\t/**\n\t\t\t\t\t\t * Does superClass data exist?\n\t\t\t\t\t\t * @type {T}\n\t\t\t\t\t\t */\n\t\t\t\t\t\tlet sClass=holder.parsedData.classes.find(function(el,i,a){\n\t\t\t\t\t\t\t//C(`${el.name}<>${classData.superClass}:${el.name==classData.superClass}`);\n\t\t\t\t\t\t\treturn el.name==classData.superClass;\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tif(!sClass){\n\t\t\t\t\t\t\tsClass=holder.existentClasses.find(function(el,i2,a2){\n\t\t\t\t\t\t\t\treturn el.name==classData.superClass;\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tC(I.yellow('sClass:'));\n\n\t\t\t\t\t\tif(!sClass){\n\t\t\t\t\t\t\tC('no superClass');\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif(sClass){\n\n\t\t\t\t\t\t\tC(sClass.name);\n\t\t\t\t\t\t\tC('\\nInserting super class for '+classData.name+'... ');\n\n\t\t\t\t\t\t\tholder.insertClass(sClass).then(function(r){\n\n\t\t\t\t\t\t\t\tC(I.green('inserted parent '+r));\n\n\t\t\t\t\t\t\t\tholder.insertClassCheckless(classData).then(function(r1){\n\n\t\t\t\t\t\t\t\t\tC(I.green('inserted with parent '+r1));\n\t\t\t\t\t\t\t\t\tresolve(r1);\n\n\t\t\t\t\t\t\t\t}).catch(function(e){\n\n\t\t\t\t\t\t\t\t\tL('Importer #12','er',e);\n\t\t\t\t\t\t\t\t\treject(e);\n\n\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t}).catch(function(e){\n\n\t\t\t\t\t\t\t\tL('Importer #10','er',e);\n\t\t\t\t\t\t\t\treject(e);\n\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}else{\n\n\t\t\t\t\t\tC(I.blue('\\nclass ')+classData.name+I.blueBright('.hasSuper')+'('+clc.red('false')+')');\n\n\t\t\t\t\t\tholder.insertClassCheckless(classData).then(function(r){\n\n\t\t\t\t\t\t\tC(I.green('inserted parentless '+r));\n\t\t\t\t\t\t\tresolve(r);\n\n\t\t\t\t\t\t}).catch(function(e){\n\n\t\t\t\t\t\t\tL('Importer #11','er',e);\n\t\t\t\t\t\t\treject(e);\n\n\t\t\t\t\t\t});\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t\t/*.catch(function(e){\n\t\t\t\tif(e){\n\t\t\t\tC('\\nclassExists.catch:');\n\t\t\t\tC(clc.red(e));\n\t\t\t\tC('\\n');\n\t\t\t\t}\n\t\t\t\t})*/\n\n\t\t\t});\n\n\t\t});\n\n\t}\n\n\t/**\n\t *\n\t * @param data  : parsedData format\n\t * @param connConfig : (cnf.json).orient format\n\t * @returns {Promise}\n\t */\n\timportParsedData(data){\n\n\t\tvar holder=this;\n\n\t\treturn new Promise(function(resolve,reject){\n\n\t\t\tif(!data||!data.classes){\n\t\t\t\treject(new Error('Importer Error #13 importing data: the data is incorrect.'));\n\t\t\t}\n\n\t\t\tholder.dropClasses(data.classes).then(function(rd){\n\n\t\t\t\tL('dropClasses result: '+I.yellowBright(rd));\n\n\t\t\t\tholder.getExistentClasses().then(function(rExistentClasses){\n\n\t\t\t\t\tC('rExistentClasses:');\n\t\t\t\t\trExistentClasses.forEach(function(v0,i0){\n\t\t\t\t\t\tC(v0.name);\n\t\t\t\t\t});\n\t\t\t\t\tL();\n\n\t\t\t\t\ttry{\n\n\t\t\t\t\t\tholder.parsedData=data;\n\n\t\t\t\t\t\tlet promises=[];\n\t\t\t\t\t\tdata.classes.forEach(function(classData){\n\t\t\t\t\t\t\tpromises.push(holder.insertClass(classData));\n\t\t\t\t\t\t});\n\t\t\t\t\t\tpromises.push(new Promise(function(rs,rj){\n\t\t\t\t\t\t\tsetTimeout(function(){\n\t\t\t\t\t\t\t\trj(new Error('Timeout '+holder.cnf.timeout+' ms'));\n\t\t\t\t\t\t\t},holder.cnf.timeout);\n\t\t\t\t\t\t}));\n\n\t\t\t\t\t\tPromise.all(promises).then(function(r){\n\n\t\t\t\t\t\t\tL('all classes resolved','ok');\n\t\t\t\t\t\t\tresolve(r);\n\n\t\t\t\t\t\t}).catch(function(e){\n\n\t\t\t\t\t\t\tL('Importer #6','er',e);\n\t\t\t\t\t\t\treject(new Error('Error in database communication #1'));\n\n\t\t\t\t\t\t});\n\n\t\t\t\t\t}catch(e){\n\n\t\t\t\t\t\tL('Importer #7','er',e);\n\t\t\t\t\t\treject(new Error('Error in database communication #2'));\n\n\t\t\t\t\t}\n\n\t\t\t\t}).catch(function(e){\n\t\t\t\t\tL('Importer #12','er',e);\n\t\t\t\t\treject(e);\n\t\t\t\t});\n\n\t\t\t}).catch(function(e){\n\t\t\t\tL('Importer #14','er',e);\n\t\t\t\treject(e);\n\t\t\t});\n\n\n\t\t});\n\n\t}\n\n}\n\n"],"sourceRoot":"/source/"}