{"version":3,"sources":["parser.es7.js"],"names":[],"mappings":"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","file":"parser.es7.js","sourcesContent":["/**\n * Created by Denis Bondarenko <bond.den@gmail.com> on 16.05.2015.\n */\n'use strict';\nvar\n\tfs=require('fs'),\n\t//chalk    =require('chalk'),\n\tcolors = require('colors')\n\t//clc = require('cli-color')\n;\n/**\n * Parses *.puml to temporary json format and to memory\n */\nexport class Parser{\n\n\tconstructor(config){\n\t\tthis.cnf=config;\n\t\tthis.parsedData=false;\n\t\tthis.init();\n\t}\n\n\tinit(){}\n\n\tget getParsedData(){\n\t\treturn this.parsedData;\n\t}\n\n\t//loadParsedData(){}\n\n\tloadPumlFile(srcFile){\n\t\treturn new Promise(function (resolve,reject){\n\t\t\ttry{\n\t\t\t\tif(!fs.existsSync(srcFile)){\n\t\t\t\t\treject(new Error('File does not exist.'));\n\t\t\t\t}\n\t\t\t\tfs.readFile(srcFile, function(e,d){\n\t\t\t\t\tif(e){\n\t\t\t\t\t\tconsole.log(e);\n\t\t\t\t\t\treject(e);\n\t\t\t\t\t}\n\n\t\t\t\t\t//console.log(srcFile+' contents: \\n'+clc.blackBright.italic(d));\n\t\t\t\t\t//console.log(srcFile+' contents: \\n'+`${d}`.dim.grey+'\\n');\n\n\t\t\t\t\tresolve(d);\n\t\t\t\t});\n\t\t\t}catch(e){\n\t\t\t\treject(e);\n\t\t\t}\n\t\t});\n\t}\n\n\tparseLoadedSource(content){\n\n\t\tvar\n\t\t\td={\n\t\t\t\t\"classes\":[],\n\t\t\t\t\"links\":[]\n\t\t\t}\n\t\t;\n\n\t\t//removing comments\n\t\ttry{\n\t\t\tcontent=(content+'').replace(/^\\s*'(.*)$/mgi,'');\n\t\t}catch(e){\n\t\t\tconsole.log('Error:'.red);\n\t\t\tconsole.log(e);\n\t\t\tthrow e;\n\t\t}\n\n\t\t//finding classes\n\t\tvar classes=content.match(\n\t\t\t/(abstract\\s+)?class\\s+([\\w\\.]+)(\\s+extends\\s+([\\w\\.]+))?(\\s*\\{\\s*([#+\\-]?[\\w:]*((\\(\\))|(\\[\\])|(\\{\\}))?\\s*)*\\s*\\})?/gi\n\t\t);\n\n\t\tclasses.forEach(function(v){\n\n\t\t\tvar c={\n\t\t\t\t\"name\":\"\",\n\t\t\t\t\"superClass\":\"\",\n\t\t\t\t\"properties\":[\n\t\t\t\t\t{\n\t\t\t\t\t\t\"name\":\"package\",\n\t\t\t\t\t\t\"type\":\"STRING\"\n\t\t\t\t\t}\n\t\t\t\t]\n\t\t\t};\n\n\t\t\tvar tmp=content.split(v)[0].split('package');\n\t\t\tif(tmp.length>1){\n\t\t\t\tvar pkg=tmp.pop();\n\t\t\t\tvar pkgFind=pkg.match(/^\\s*([\\w]+)\\s*\\{\\s*$/im);\n\t\t\t\tif(pkgFind && pkgFind.length>1){\n\t\t\t\t\tc.properties.package=pkgFind[1];\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif(/abstract/ig.test(v)){\n\t\t\t\tc.abstract=true;\n\t\t\t}\n\n\t\t\tvar ext=v.match(/extends\\s+([\\w\\.]+)/ig);\n\t\t\tif(ext && ext.length){\n\t\t\t\tc.superClass=ext[0].replace(/extends\\s+/ig,'').trim();\n\t\t\t}\n\n\t\t\tvar name=v.match(/class\\s+([\\w\\.]+)(\\s*|\\s*\\{\\s*)/ig);\n\t\t\tif(name && name.length){\n\t\t\t\tc.name=name[0].replace(/class\\s+/ig,'').trim().replace('{','').trim();\n\t\t\t}\n\n\t\t\tif(!c.name.length||!/\\w/i.test(c.name)){\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvar contentString=\"\";\n\t\t\tvar cs=v.match(/{([\\w\\W\\s\\S]+)}/ig);\n\t\t\tif(cs && cs.length){\n\t\t\t\tcontentString=cs[0].trim()\n\t\t\t\t\t.replace(/\\t+/ig,'')\n\t\t\t\t\t.replace(/[ ]+/ig,' ')\n\t\t\t\t\t.replace(/((^\\{)|(\\}$))/img,'')\n\t\t\t\t\t.trim()\n\t\t\t\t;\n\t\t\t}\n\n\t\t\t//parsing class-specific properties\n\t\t\t//default type for any property is STRING\n\t\t\tvar props=contentString.split('\\n');\n\t\t\tif(props && props.length){\n\t\t\t\tprops.forEach(function(v){\n\n\t\t\t\t\tif(!v.length){\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\t//strip private properties\n\t\t\t\t\tvar pName=v.trim();\n\t\t\t\t\tif(pName[0]=='-'){\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tpName=pName.replace(/^[+#]/img,'');\n\n\t\t\t\t\tvar p={\n\t\t\t\t\t\t\"name\":pName,\n\t\t\t\t\t\t\"type\":\"STRING\"\n\t\t\t\t\t};\n\n\t\t\t\t\tvar typedName=p.name.split(':');\n\t\t\t\t\tif(typedName&&typedName.length>1){\n\t\t\t\t\t\tp.name=typedName[0];\n\t\t\t\t\t\tp.type=typedName[1].trim().toUpperCase();\n\t\t\t\t\t}\n\n\t\t\t\t\tif(/\\{$/img.test(p.name)){\n\t\t\t\t\t\tp.name=p.name.split('{')[0];\n\t\t\t\t\t\tif(p.type===''){\n\t\t\t\t\t\t\tp.type='EMBEDDED'\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif(/\\[\\]$/img.test(p.name)){\n\t\t\t\t\t\tp.name=p.name.split('[')[0];\n\t\t\t\t\t\tif(p.type===''){\n\t\t\t\t\t\t\tp.type='EMBEDDEDLIST'\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif(/\\[\\]$/img.test(p.type)){\n\t\t\t\t\t\tp.linkedClass=p.type.split('[')[0];\n\t\t\t\t\t\tp.type='LINKSET';\n\t\t\t\t\t}\n\n\t\t\t\t\tc.properties.push(p);\n\n\t\t\t\t});\n\t\t\t}\n\n\t\t\t//strip generic classes, that are included in ./d/init.odb.json\n\t\t\tif(\n\t\t\t\tc.name!=='V' &&\n\t\t\t\tc.name!=='E'\n\t\t\t){\n\t\t\t\td.classes.push(c);\n\t\t\t}\n\n\t\t});\n\n\t\tvar inheritance=content.match(\n\t\t\t/([\\.\\w]+)\\s*\\-[ultr]?\\-\\|>\\s*(\\w+)/gi\n\t\t);\n\t\tif(inheritance && inheritance.length){\n\t\t\tinheritance.forEach(function(v){\n\n\t\t\t\tvar a=v.split(/\\s*\\-[ultr]?\\-\\|>\\s*/gi);\n\n\t\t\t\t//handling dot\n\t\t\t\ta.forEach(function(va,ia,a){\n\t\t\t\t\t//todo: handle namespaces\n\t\t\t\t\tvar vaa=va.split('.');\n\t\t\t\t\tif(Array.isArray(vaa) && vaa.length==2){\n\t\t\t\t\t\ta[ia]=vaa[1];\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\t//handling inheritance\n\t\t\t\tvar className=a[0];\n\t\t\t\tvar byClassName=function(classInstance){\n\t\t\t\t\treturn className==classInstance.name;\n\t\t\t\t};\n\t\t\t\tvar cl=d.classes.filter(byClassName);\n\t\t\t\tcl.forEach(function(vc){\n\t\t\t\t\tvc.superClass=a[1];\n\t\t\t\t});\n\n\t\t\t});\n\t\t}\n\n\t\t//console.log('\\n//parseData'.bold+`${d}`.blue+'\\n');\n\n\t\treturn d;\n\n\t}\n\n\t/*saveToFile(targetFile){\n\n\t}*/\n\n\tparse(pumlFile){\n\n\t\t//console.log('//at Parser.parse');\n\n\t\tvar holder=this;\n\n\t\treturn new Promise(function(resolve,reject){\n\n\t\t\t//console.log('//at Parser.parse Promise');\n\n\t\t\tholder.loadPumlFile(pumlFile).then(function(d){\n\n\t\t\t\t//console.log('\\nLoaded contents: \\n\\n'.green+`${d}`.dim.grey+'\\n');\n\n\t\t\t\tholder.parsedData=holder.parseLoadedSource(d);\n\n\t\t\t\tif(!holder.parsedData){\n\t\t\t\t\treject(new Error('Error parsing file '+pumlFile));\n\t\t\t\t}else{\n\t\t\t\t\tresolve(holder.parsedData);\n\t\t\t\t}\n\n\t\t\t}).catch(function(e){\n\t\t\t\treject(new Error('Error loading file '+pumlFile));\n\t\t\t});\n\n\n\n\t\t\t/*let saved=await this.saveToFile();\n\t\t\tif(!saved){\n\t\t\t\treject(new Error('Error saving file '+pumlFile));\n\t\t\t}*/\n\n\n\t\t});\n\n\t}\n\n\t//parseToFile(pumlFile,targetFile){}\n\n}\n"],"sourceRoot":"/source/"}