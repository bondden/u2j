{"version":3,"sources":["compiler.es7.js"],"names":[],"mappings":"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","file":"compiler.es7.js","sourcesContent":["/**\n * Created by Denis Bondarenko <bond.den@gmail.com> on 16.05.2015.\n */\n'use strict';\n\nimport * as UtilLib from '../lib/util'\n\nvar\n\tfs=require('fs-extra'),\n\tpath=require('path'),\n\tminify  = require('node-json-minify'),\n\tL\t= UtilLib.Util.log\n;\n/**\n * Compiles parsed *.puml data to OrientDB import.json\n */\nexport class Compiler{\n\n\tconstructor(cnf=false){\n\t\tthis.cnf=cnf;\n\t\tthis.init();\n\t}\n\n\tinit(){}\n\n\t//loadParsedData(){}\n\n\tcompile(data,targetFile){\n\n\t\t//console.log('//at compile');\n\n\t\tvar holder=this;\n\t\tvar r={\n\t\t\t'compiled':false,\n\t\t\t'saved':false,\n\t\t\t'valid':false,\n\t\t\t'error':null\n\t\t};\n\n\t\treturn new Promise(function(resolve,reject){\n\n\t\t\tlet s=holder.compileStr(data);\n\n\t\t\tif(typeof s ==='string'){\n\t\t\t\tr.compiled=true;\n\t\t\t}\n\n\t\t\t//console.log('//after compileStr');\n\n\t\t\tholder.saveStr(s,targetFile).then(function(d){\n\n\t\t\t\tr.saved=true;\n\n\t\t\t\tif(holder.validateJson(targetFile,holder.cnf.path.schemaFile)){\n\t\t\t\t\tr.valid=true;\n\t\t\t\t\tresolve(r);\n\t\t\t\t}else{\n\t\t\t\t\tr.error=new Error('Validation against schema failed');\n\t\t\t\t\treject(r);\n\t\t\t\t}\n\n\t\t\t}).catch(function(e){\n\t\t\t\tL('Error #1','er');\n\t\t\t\tL(e);\n\t\t\t\treject(e);\n\t\t\t});\n\n\t\t});\n\n\t}\n\n\tcompileStr(data){\n\n\t\tvar\n\t\t\tdefaultData     ={\n\t\t\t\"root\":{\n\t\t\t\t\"clusters\":[],\n\t\t\t\t\"schema\":{\n\t\t\t\t\t\"version\":2,\n\t\t\t\t\t\"classes\":[]\n\t\t\t\t},\n\t\t\t\t\"records\":[],\n\t\t\t\t\"indexes\":[],\n\t\t\t\t\"manualIndexes\":[]\n\t\t\t},\n\t\t\t\"cluster\":{\n\t\t\t\t\"id\":null,\n\t\t\t\t\"name\":null\n\t\t\t},\n\t\t\t\"schemaClass\":{\n\t\t\t\t\"name\":null,\n\t\t\t\t\"defaultClusterId\":null,\n\t\t\t\t\"clusterIds\":[],\n\t\t\t\t\"superClass\":null,\n\t\t\t\t\"clusterSelection\":\"round-robin\",\n\t\t\t\t\"properties\":[]\n\t\t\t},\n\t\t\t\"classProperty\":{\n\t\t\t\t\"name\":null,\n\t\t\t\t\"type\":\"STRING\",\n\t\t\t\t\"mandatory\":true,\n\t\t\t\t\"notNull\":true,\n\t\t\t\t\"collate\":\"default\",\n\t\t\t\t\"linkedClass\":\"Basic\"\n\t\t\t},\n\t\t\t\"record\":{\n\t\t\t\t\"@type\":\"d\",\n\t\t\t\t\"version\":0,\n\t\t\t\t\"name\":null,\n\t\t\t\t\"shortName\":null,\n\t\t\t\t\"defaultClusterId\":null,\n\t\t\t\t\"clusterIds\":[],\n\t\t\t\t\"clusterSelection\":\"round-robin\",\n\t\t\t\t\"overSize\":0.0,\n\t\t\t\t\"strictMode\":false,\n\t\t\t\t\"abstract\":false,\n\t\t\t\t\"properties\":[],\n\t\t\t\t\"superClass\":null,\n\t\t\t\t\"customFields\":null,\n\t\t\t\t\"fieldTypes\":\"overSize=f,properties=e\"\n\t\t\t},\n\t\t\t\"recordProperty\":{\n\t\t\t\t\"@type\":\"d\",\n\t\t\t\t\"version\":0,\n\t\t\t\t\"name\":null,\n\t\t\t\t\"type\":null,\n\t\t\t\t\"globalId\":null,\n\t\t\t\t\"mandatory\":false,\n\t\t\t\t\"readonly\":false,\n\t\t\t\t\"notNull\":false,\n\t\t\t\t\"min\":null,\n\t\t\t\t\"max\":null,\n\t\t\t\t\"regexp\":null,\n\t\t\t\t\"linkedClass\":null,\n\t\t\t\t\"customFields\":null,\n\t\t\t\t\"collate\":\"default\"\n\t\t\t}\n\t\t},\n\n\t\t\trules         ={\n\n\t\t\t\t\"meta\":{\n\t\t\t\t\t\"clusterStartId\":10//,\n\t\t\t\t\t//\"schemaStartVersion\":1\n\t\t\t\t},\n\n\t\t\t\t\"templates\":{\n\t\t\t\t\t\"root\":{\n\t\t\t\t\t\t\"info\":function(d){\n\t\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\t\t\"name\":d.info.name,\n\t\t\t\t\t\t\t\t\"schema-version\":d.schema.version,\n\t\t\t\t\t\t\t\t\"default-cluster-id\":3,\n\t\t\t\t\t\t\t\t\"exporter-version\":11,\n\t\t\t\t\t\t\t\t\"engine-version\":\"2.0.8\",\n\t\t\t\t\t\t\t\t\"engine-build\":\"UNKNOWN@r$buildNumber; 2015-04-22 20:47:49+0000\",\n\t\t\t\t\t\t\t\t\"storage-config-version\":14,\n\t\t\t\t\t\t\t\t\"mvrbtree-version\":3,\n\t\t\t\t\t\t\t\t\"schemaRecordId\":\"#0:1\",\n\t\t\t\t\t\t\t\t\"indexMgrRecordId\":\"#0:2\"\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t},\n\t\t\t\t\t\t\"clusters\":function(d){\n\t\t\t\t\t\t\treturn d.clusters;\n\t\t\t\t\t\t},\n\t\t\t\t\t\t\"schema\":{\n\t\t\t\t\t\t\t\"version\":function(d){\n\t\t\t\t\t\t\t\treturn d.schema.version\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\"classes\":function(d){\n\t\t\t\t\t\t\t\treturn d.classes;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\t\"records\":function(d){\n\t\t\t\t\t\t\treturn d.records;\n\t\t\t\t\t\t},\n\t\t\t\t\t\t\"indexes\":function(d){\n\t\t\t\t\t\t\treturn d.indexes;\n\t\t\t\t\t\t},\n\t\t\t\t\t\t\"manualIndexes\":function(d){\n\t\t\t\t\t\t\treturn d.manualIndexes;\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\t\"cluster\":function(d){\n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\t\"name\":d.name,\n\t\t\t\t\t\t\t\"id\":d.id\n\t\t\t\t\t\t};\n\t\t\t\t\t},\n\t\t\t\t\t\"schemaClass\":function(d){\n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\t\"name\":d.name,\n\t\t\t\t\t\t\t\"default-cluster-id\":d.defaultClusterId,\n\t\t\t\t\t\t\t\"cluster-ids\":d.clusterIds,\n\t\t\t\t\t\t\t\"super-class\":d.superClass,\n\t\t\t\t\t\t\t\"cluster-selection\":d.clusterSelection,\n\t\t\t\t\t\t\t\"properties\":d.properties\n\t\t\t\t\t\t};\n\t\t\t\t\t},\n\t\t\t\t\t\"classProperty\":function(d){\n\t\t\t\t\t\tvar r={\n\t\t\t\t\t\t\t\"name\":d.name,\n\t\t\t\t\t\t\t\"type\":d.type,\n\t\t\t\t\t\t\t\"mandatory\":d.mandatory,\n\t\t\t\t\t\t\t\"not-null\":d.notNull,\n\t\t\t\t\t\t\t\"collate\":d.collate\n\t\t\t\t\t\t};\n\t\t\t\t\t\tif(\n\t\t\t\t\t\t\t[\n\t\t\t\t\t\t\t\t'EMBEDDEDLIST',\n\t\t\t\t\t\t\t\t'EMBEDDEDSET',\n\t\t\t\t\t\t\t\t'EMBEDDEDMAP',\n\t\t\t\t\t\t\t\t'LINKLIST',\n\t\t\t\t\t\t\t\t'LINKSET',\n\t\t\t\t\t\t\t\t'LINKMAP',\n\t\t\t\t\t\t\t\t'LINKBAG'\n\t\t\t\t\t\t\t].indexOf(d.type)!== -1\n\t\t\t\t\t\t){\n\t\t\t\t\t\t\tr['linked-class']='Basic';\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn r;\n\t\t\t\t\t},\n\t\t\t\t\t\"record\":function(d){\n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\t\"@type\":\"d\",\n\t\t\t\t\t\t\t\"@version\":d.version,\n\t\t\t\t\t\t\t\"name\":d.name,\n\t\t\t\t\t\t\t\"shortName\":d.shortName,\n\t\t\t\t\t\t\t\"defaultClusterId\":d.defaultClusterId,\n\t\t\t\t\t\t\t\"clusterIds\":d.clusterIds,\n\t\t\t\t\t\t\t\"clusterSelection\":d.clusterSelection,\n\t\t\t\t\t\t\t\"overSize\":d.overSize,\n\t\t\t\t\t\t\t\"strictMode\":d.strictMode,\n\t\t\t\t\t\t\t\"abstract\":d.abstract,\n\t\t\t\t\t\t\t\"properties\":d.properties,\n\t\t\t\t\t\t\t\"superClass\":d.superClass,\n\t\t\t\t\t\t\t\"customFields\":d.customFields,\n\t\t\t\t\t\t\t\"@fieldTypes\":d.fieldTypes\n\t\t\t\t\t\t};\n\t\t\t\t\t},\n\t\t\t\t\t\"recordProperty\":function(d){\n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\t\"@type\":\"d\",\n\t\t\t\t\t\t\t\"@version\":d.version,\n\t\t\t\t\t\t\t\"name\":d.name,\n\t\t\t\t\t\t\t\"type\":d.type,\n\t\t\t\t\t\t\t\"globalId\":d.globalId,\n\t\t\t\t\t\t\t\"mandatory\":d.mandatory,\n\t\t\t\t\t\t\t\"readonly\":d.readonly,\n\t\t\t\t\t\t\t\"notNull\":d.notNull,\n\t\t\t\t\t\t\t\"min\":d.min,\n\t\t\t\t\t\t\t\"max\":d.max,\n\t\t\t\t\t\t\t\"regexp\":d.regexp,\n\t\t\t\t\t\t\t\"linkedClass\":d.linkedClass,\n\t\t\t\t\t\t\t\"customFields\":d.customFields,\n\t\t\t\t\t\t\t\"collate\":d.collate\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\n\t\t\tcompileTpl=function(tplId,data){\n\n\t\t\t\tvar\n\t\t\t\t\ttpl    =rules.templates[tplId],\n\t\t\t\t\ttmpData=JSON.parse(JSON.stringify(defaultData[tplId]));\n\n\t\t\t\tfor(var p in data){\n\t\t\t\t\tif(tmpData.hasOwnProperty(p)){\n\t\t\t\t\t\ttmpData[p]=data[p];\n\t\t\t\t\t}else{\n\t\t\t\t\t\tObject.defineProperty(tmpData,p,{\n\t\t\t\t\t\t\tvalue:data[p],\n\t\t\t\t\t\t\twritable:true,\n\t\t\t\t\t\t\tconfigurable:true\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn tpl(tmpData);\n\n\t\t\t},\n\n\t\t\tmainRule  =function(parsedData){\n\n\t\t\t\tvar initRaw=fs.readFileSync(path.join(__dirname,'../d','init.odb.json'));\n\t\t\t\tvar data   =JSON.parse(initRaw);\n\n\t\t\t\tdata.info['schema-version']++;\n\t\t\t\tdata.schema.version++;\n\n\t\t\t\t//compiling classes;\n\t\t\t\tparsedData.classes.forEach(function(v,i){\n\n\t\t\t\t\t//compiling properties\n\t\t\t\t\tv.properties.forEach(function(vp,ip){\n\t\t\t\t\t\tv.properties[ip]=compileTpl('classProperty',vp);\n\t\t\t\t\t});\n\n\t\t\t\t\tvar clusterId=-1;\n\n\t\t\t\t\tif(v.hasOwnProperty('abstract')&&v.abstract){\n\n\t\t\t\t\t\tdelete v.abstract;\n\n\t\t\t\t\t}else{\n\n\t\t\t\t\t\tclusterId=rules.meta.clusterStartId+i+1;\n\n\t\t\t\t\t\t//adding a cluster for the class\n\t\t\t\t\t\tdata.clusters.push(compileTpl('cluster',{\n\t\t\t\t\t\t\t\"name\":v.name.toLowerCase(),\n\t\t\t\t\t\t\t\"id\":clusterId\n\t\t\t\t\t\t}));\n\n\t\t\t\t\t}\n\n\t\t\t\t\tv.defaultClusterId=clusterId;\n\t\t\t\t\tv.clusterIds=[clusterId];\n\n\t\t\t\t\t//adding compiled class\n\t\t\t\t\tdata.schema.classes.push(compileTpl('schemaClass',v));\n\n\t\t\t\t});\n\n\t\t\t\treturn data;\n\n\t\t\t}\n\t\t;\n\n\t\tlet parsedData=mainRule(data);\n\n\t\tvar compiledData=minify(\n\t\t\tJSON.stringify(\n\t\t\t\tparsedData\n\t\t\t)\n\t\t);\n\n\t\t//floatProps\n\t\t[\n\t\t\t{\n\t\t\t\t\"search\":/\"overSize\":([0-9]+)(,?)/ig,\n\t\t\t\t\"replace\":'\"overSize\":$1.0$2'\n\t\t\t}\n\t\t].forEach(function(propRule){\n\t\t\tcompiledData=compiledData.replace(propRule.search,propRule.replace);\n\t\t});\n\n\t\treturn compiledData;\n\t}\n\n\tsaveStr(str,targetFile){\n\n\t\treturn new Promise(function(resolve,reject){\n\n\t\t\ttry{\n\n\t\t\t\tfs.writeFile(targetFile,str,function(e){\n\n\t\t\t\t\tif(e){\n\t\t\t\t\t\tconsole.log(e);\n\t\t\t\t\t\treject(e);\n\t\t\t\t\t}\n\n\t\t\t\t\tresolve(true);\n\n\t\t\t\t});\n\n\t\t\t}catch(e){\n\t\t\t\tconsole.log(e);\n\t\t\t\treject(e);\n\t\t\t}\n\n\t\t});\n\t}\n\n\tvalidateJson(fileName,schemaFileName){\n\n\t\t//console.log('//at validateJson');\n\n\t\tlet proc=async function(){\n\n\t\t\tlet validator=require('is-my-json-valid');\n\n\t\t\tlet schemaRaw=await fs.readFileSync(schemaFileName);\n\n\t\t\t//cinsole.log('\\nvalidateJson.schemaRaw:\\n'.cyan+`${schemaRaw}`+'\\n');\n\n\t\t\tlet schema   =JSON.parse(schemaRaw);\n\n\t\t\t//console.log('1. schema parsed'.cyan);\n\n\t\t\tlet jRaw=await fs.readFileSync(fileName);\n\t\t\tlet json=JSON.parse(jRaw);\n\n\t\t\t//console.log('2. file parsed');\n\n\t\t\tlet validate        =validator(schema);\n\t\t\tlet validationResult=validate(json);\n\n\t\t\tif(!validationResult){\n\t\t\t\tL(validate.errors);\n\t\t\t}\n\n\t\t\t//console.log('3. result is ready');\n\n\t\t\treturn validationResult;\n\n\t\t};\n\n\t\treturn new Promise(function(resolve,reject){\n\n\t\t\tif(proc()){\n\t\t\t\tresolve(true);\n\t\t\t}else{\n\t\t\t\treject(false);\n\t\t\t}\n\n\t\t});\n\n\t}\n\n}\n"],"sourceRoot":"/source/"}